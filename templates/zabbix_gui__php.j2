[zabbix]
{% if php_fpm[item.key]['vars']['tcp_ip_socket']['enabled'] %}
listen = {{ php_fpm[item.key]['vars']['tcp_ip_socket']['listen'] }}

user = {{ php_fpm[item.key]['vars']['webserver_user'] }}
group = {{ php_fpm[item.key]['vars']['webserver_group'] }}
{% endif %}

{% if php_fpm[item.key]['vars']['unix_socket']['enabled'] %}
listen = {{ php_const[ansible_os_family][php.src]['php_fpm_unix_socket_path'] }}{{ php_fpm[item.key]['vars']['unix_socket']['file'] }}

user = {{ php_fpm[item.key]['vars']['unix_socket']['user'] }}
group = {{ php_fpm[item.key]['vars']['unix_socket']['group'] }}

listen.owner = {{ php_fpm[item.key]['vars']['webserver_user'] }}
listen.group = {{ php_fpm[item.key]['vars']['webserver_group'] }}
listen.mode = 0660
{% endif %}

pm = {{ php_fpm[item.key]['vars']['pm']}}
pm.max_children = {{ php_fpm[item.key]['vars']['pm_max_children'] }}
pm.start_servers = {{ php_fpm[item.key]['vars']['pm_start_servers'] }}
pm.min_spare_servers = {{ php_fpm[item.key]['vars']['pm_min_spare_servers'] }}
pm.max_spare_servers = {{ php_fpm[item.key]['vars']['pm_max_spare_servers'] }}

php_value[session.save_handler] = files
php_value[session.save_path]    = /var/lib/php/sessions/

php_value[max_execution_time] = 300
php_value[memory_limit] = 128M
php_value[post_max_size] = 16M
php_value[upload_max_filesize] = 2M
php_value[max_input_time] = 300
php_value[max_input_vars] = 10000
php_value[date.timezone] = {{ php_fpm[item.key]['vars']['date_timezone'] | default("Europe/Moscow") }}